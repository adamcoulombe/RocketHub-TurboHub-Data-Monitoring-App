{"version":3,"sources":["App.js","serviceWorker.js","index.js"],"names":["App","props","state","entries","range","currentUsage","todayUsage","options","chart","id","xaxis","categories","series","name","data","dataLabels","enabled","todayGaugeOptions","todayGaugeSeries","this","getEntries","PullToRefresh","init","mainElement","onRefresh","window","location","reload","fetch","hostname","moment","valueOf","then","res","text","resData","JSON","parse","setState","updateChartData","bind","periodStartTime","periodEndTime","date","endOf","isBefore","startOf","add","subtract","daysUntilPeriodEnd","diff","todayStartTime","todayDataPartition","_","partition","o","time","prevTodayData","todayData","periodData","prevPeriodData","dataSet","filter","isSameOrAfter","lastUsagePrevToday","parseFloat","last","usage","lastUsagePrevPeriod","currentUsageThisPeriod","toFixed","remainingDailyDataThisPeriod","currentUsageToday","timeData","map","usageSeries","v","gaugeColorMap","interpolate","timeLabels","format","type","offsetY","sparkline","plotOptions","radialBar","startAngle","endAngle","track","background","strokeWidth","margin","show","value","grid","padding","top","fill","colors","className","height","join","onClick","setRange","toolbar","React","Component","Boolean","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.bc244be6.chunk.js","sourcesContent":["import React from 'react';\nimport './App.scss';\nimport _ from 'lodash';\nimport 'moment';\nimport moment from 'moment';\nimport Chart from 'react-apexcharts'\nimport interpolate from 'color-interpolate'\nimport PullToRefresh from 'pulltorefreshjs';\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { \n      entries: [],\n      range:'today',\n      currentUsage:'',\n      todayUsage:'',\n      options: {\n        chart: {\n          id: 'data-usage'\n        },\n        xaxis: {\n          categories: []\n        }\n      },\n      series: [{\n        name: 'usage',\n        data: []\n      }],\n      dataLabels: {\n        enabled: false,\n      },\n      todayGaugeOptions:{},\n      todayGaugeSeries:[]\n    };\n  }\n\n  componentWillMount() {\n      this.getEntries();\n  }\n  componentDidMount(){\n    const ptr = PullToRefresh.init({\n      mainElement: 'body',\n      onRefresh:()=> {\n        window.location.reload();\n      }\n    });\n   \n  }\n  getEntries() {\n    fetch(\"http://\"+window.location.hostname+\":3901/api/all?timestamp=\"+ moment().valueOf())\n        .then(res => res.text())\n        .then(\n          (res) => {\n            const resData = JSON.parse(res);\n            this.setState({ entries: resData }, this.updateChartData.bind(this))\n     \n          } \n        );\n  }\n  updateChartData(){\n    let periodStartTime;\n    let periodEndTime;\n    if(moment().date(9).endOf('day').isBefore(moment())){\n      periodStartTime=moment().date(10).startOf('day')\n      periodEndTime=moment().date(10).add(1,'months').endOf('day')\n    }else{\n      periodStartTime=moment().date(10).subtract(1,'months').startOf('day')\n      periodEndTime=moment().date(10).endOf('day')\n    }\n    const daysUntilPeriodEnd = periodEndTime.diff(moment(),'days');\n    // console.log(moment().date(9).endOf('day').format(\"dddd, MMMM Do YYYY, h:mm:ss a\"));\n    // console.log(moment().format(\"dddd, MMMM Do YYYY, h:mm:ss a\"));\n    \n    const todayStartTime=moment().startOf('day');\n    const todayDataPartition = _.partition(this.state.entries, function(o) { \n      return moment(o.time).isBefore(todayStartTime);\n    });\n    const prevTodayData = todayDataPartition[0];\n    const todayData = todayDataPartition[1];    \n\n    const periodData = _.partition(this.state.entries, function(o) { \n      return moment(o.time).isBefore(periodStartTime);\n    });\n    const prevPeriodData = periodData[0];\n    const currentPeriodData = periodData[1];\n    // console.log(prevPeriodData);\n    let dataSet = currentPeriodData;\n    if(this.state.range=='last-hour'){\n      dataSet = _.filter(this.state.entries, function(o) { \n        return moment(o.time).isSameOrAfter(moment().subtract(1,'hour'));\n      });\n    }else if(this.state.range=='all'){\n      dataSet = this.state.entries;\n    }else if(this.state.range=='today'){\n      dataSet = todayData;\n    }\n\n    //console.log(dataSet);\n    const lastUsagePrevToday = parseFloat(_.last(prevTodayData).usage);\n    const lastUsagePrevPeriod = parseFloat(_.last(prevPeriodData).usage);\n    const currentUsageThisPeriod = (parseFloat(_.last(this.state.entries).usage)-lastUsagePrevPeriod).toFixed(2);\n    const remainingDataThisPeriod = 200-currentUsageThisPeriod;\n    const remainingDailyDataThisPeriod = (remainingDataThisPeriod/daysUntilPeriodEnd).toFixed(2);\n    const currentUsageToday = (parseFloat(_.last(this.state.entries).usage)-lastUsagePrevToday).toFixed(2);\n    const timeData = _.map(dataSet, 'time')\n    const usageData = _.map(dataSet, 'usage')\n    const usageSeries = usageData.map((v)=>{\n      return (parseFloat(v)-lastUsagePrevPeriod).toFixed(2)\n    })\n    let gaugeColorMap = interpolate(['#33e9ab','#67b244', '#E0B336','#fd9a2d', '#fd5f76']);\n    const timeLabels = timeData.map((v)=>{\n      return moment(v).format(\"dd M, h:mmA\");\n    })\n    this.setState({\n      currentUsage:currentUsageThisPeriod,\n      todayUsage:currentUsageToday,\n      remainingDailyDataThisPeriod:remainingDailyDataThisPeriod,\n      options:{\n        chart: {\n          id: 'data-usage'\n        },\n        xaxis: {\n          categories: timeLabels\n        },\n        dataLabels: {\n          enabled: false,\n        }\n      },\n      series:[{\n        name: 'usage',\n        data: usageSeries\n      }],\n\n          \n      todayGaugeSeries: [currentUsageToday/remainingDailyDataThisPeriod*100],\n      todayGaugeOptions: {\n        chart: {\n          type: 'radialBar',\n          offsetY: -20,\n          sparkline: {\n            enabled: true\n          },\n          \n        },  \n        plotOptions: {\n          radialBar: {\n            startAngle: -90,\n            endAngle: 90,\n            track: {\n              background: \"#e7e7e7\",\n              strokeWidth: '97%',\n              margin: 5, // margin is in pixels\n            },\n            dataLabels: {\n              name: {\n                show: false,\n              },\n              value: {\n                show: false,\n              }\n            }\n          }\n        },\n        grid: {\n          padding: {\n            top: -10\n          }\n        },\n        fill: {\n          colors: [gaugeColorMap(currentUsageToday/remainingDailyDataThisPeriod)]\n        },\n      },\n    })\n  }\n  setRange(range){\n    this.setState({range:range},this.updateChartData.bind(this));\n  }\n\n  render(){\n    return (\n      <div className=\"App\">\n        <div className=\"app-inner\">\n\n          \n          <header className=\"header\">\n            <div className=\"kpi\">\n              <div className=\"kpi-data\">\n                <div className=\"label\">Month's Usage</div>\n                <div className=\"number\">{this.state.currentUsage}<span className=\"unit\"> / 200GB</span></div>\n              </div>\n            </div>\n            <div className=\"kpi\">\n              <div className=\"meter\">\n                <Chart options={this.state.todayGaugeOptions} series={this.state.todayGaugeSeries} type=\"radialBar\" height=\"280\" />\n              </div>\n              <div className=\"kpi-data\">\n                <div className=\"label\">Today's Usage</div>\n      <div className=\"number\">{this.state.todayUsage}<span className=\"unit\"> / { this.state.remainingDailyDataThisPeriod}GB</span></div>\n              </div>\n            </div>\n          </header>\n          <div \n            className={['chart-panel',`range-${this.state.range}`].join(' ')}\n          >\n            <nav id=\"nav\">\n              <div className=\"nav-inner\">\n                <a className=\"nav-item nav-item-today\" onClick={this.setRange.bind(this,'today')}>Today</a>\n                <a className=\"nav-item nav-item-current-period\" onClick={this.setRange.bind(this,'current-period')}>This Month</a>\n                <a className=\"nav-item nav-item-last-hour\" onClick={this.setRange.bind(this,'last-hour')}>Last Hour</a>\n                <a className=\"nav-item nav-item-all\" onClick={this.setRange.bind(this,'all')}>All</a>\n              </div>\n            </nav>\n            <Chart options={this.state.options} toolbar={this.state.toolbar} series={this.state.series} type=\"area\" height=\"300\" />\n\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}